{% extends "./base/base.html" %}

{% block content %}
<div class="mobile-header">
    <div class="mobile-brand">
        <h1>DisasterAlertBot</h1>
        <div class="mobile-location" id="mobile-location-trigger">
            <span id="mobile-location-text">Baguio City</span>
            <i class="bi bi-chevron-down" style="font-size: 0.7rem;"></i>
        </div>
    </div>
    <div class="mobile-profile-icon" id="mobile-profile-trigger">
        <i class="bi bi-person"></i>
    </div>
</div>

<div id="mobile-location-dropdown" class="location-dropdown-menu" style="top: 60px; left: 15px; width: calc(100% - 30px);">
    <div class="location-option" onclick="updateLocation('Manila')">Manila</div>
    <div class="location-option" onclick="updateLocation('Cebu City')">Cebu City</div>
    <div class="location-option" onclick="updateLocation('Davao City')">Davao City</div>
    <div class="location-option" onclick="updateLocation('Baguio City')">Baguio City</div>
</div>

<div id="mobile-profile-dropdown" class="profile-dropdown-menu">
    <div class="profile-header-info">
        <div class="d-flex align-items-center mb-2">
            <div class="avatar-circle me-2" style="width: 32px; height: 32px; font-size: 0.8rem;">U</div>
            <strong>User</strong>
        </div>
        <small>user_test@gmail.com</small>
    </div>
    <div class="profile-option sign-out-option" onclick="alert('Signing out...')">
        <i class="bi bi-box-arrow-right me-2"></i> Sign Out
    </div>
</div>

<div class="container-fluid h-100 p-0">
    <div class="row g-0 h-100" id="main-row">
        
        <div class="col-lg-3 d-none d-lg-flex sidebar-left" id="sidebar-left">
            <div class="mb-4">
                <h1 class="brand-title">DisasterAlertBot</h1>
                <p class="brand-subtitle">Philippine Disaster Preparedness</p>
            </div>

            <div class="mb-4 position-relative">
                <label class="section-label">LOCATION</label>
                <div class="d-flex align-items-center custom-select" id="desktop-location-trigger">
                    <div class="d-flex align-items-center flex-grow-1">
                        <i class="bi bi-geo-alt text-primary me-2"></i>
                        <span class="fw-medium" id="desktop-location-text">Baguio City</span>
                    </div>
                    <i class="bi bi-chevron-down text-secondary"></i>
                </div>
                
                <div id="desktop-location-dropdown" class="location-dropdown-menu">
                    <div class="location-option" onclick="updateLocation('Manila')">Manila</div>
                    <div class="location-option" onclick="updateLocation('Cebu City')">Cebu City</div>
                    <div class="location-option" onclick="updateLocation('Davao City')">Davao City</div>
                    <div class="location-option" onclick="updateLocation('Baguio City')">Baguio City</div>
                    <div class="location-option detect-btn" onclick=""> 
                        <i class="bi bi-crosshair me-2"></i> Use Current Location 
                    </div>
                </div>
            </div>

            <div class="mb-4 overflow-auto flex-grow-1">
                <div class="hotline-card">
                    <div class="hotline-icon-box">
                        <i class="bi bi-telephone-fill"></i>
                    </div>
                    <div class="hotline-info">
                        <h6>MMDA Hotline</h6>
                        <small>136</small>
                    </div>
                </div>

                <div class="hotline-card">
                    <div class="hotline-icon-box">
                        <i class="bi bi-life-preserver"></i>
                    </div>
                    <div class="hotline-info">
                        <h6>Phil. Coast Guard</h6>
                        <small>(02) 8527-8481</small>
                    </div>
                </div>

                <div class="hotline-card">
                    <div class="hotline-icon-box">
                        <i class="bi bi-cloud-lightning-rain-fill"></i>
                    </div>
                    <div class="hotline-info">
                        <h6>PAGASA Weather</h6>
                        <small>(02) 8929-4638</small>
                    </div>
                </div>
            </div>

            <div class="user-profile">
                <div class="d-flex align-items-center mb-3">
                    <div class="avatar-circle me-3">U</div>
                    <div style="overflow: hidden;">
                        <h6 class="mb-0 text-truncate">User</h6>
                        <small class="text-muted text-truncate d-block" style="font-size: 0.75rem;">user_test@gmail.com</small>
                    </div>
                </div>
                <button class="sign-out-btn">
                    <i class="bi bi-box-arrow-right me-2"></i> Sign Out
                </button>
            </div>
        </div>

        <div class="col-12 col-lg-6 chat-main" id="chat-main">
            
            <button class="toggle-sidebar-btn toggle-right d-none d-lg-flex" onclick="toggleRightSidebar()" title="Toggle Right Sidebar">
                <i class="bi bi-layout-sidebar-reverse"></i>
            </button>

            <div id="chat-window" class="chat-window">
                
                <div class="message bot">
                    <div class="bubble bot">
                        Kamusta, kababayan! I'm DisasterAlertBot, your AI assistant for disaster preparedness in the Philippines.
                        <br><br>
                        How can I help you stay safe today?
                    </div>
                    <span class="msg-time">{{ now.strftime('%I:%M %p') }}</span>
                </div>

                <div id="loading-dots" class="typing-indicator" style="display: none;">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>

            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <input type="text" id="user-input" placeholder="Ask about disaster preparedness..." autocomplete="off">
                    <button id="send-btn" class="send-btn-icon">
                        <i class="bi bi-send-fill"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-lg-3 d-none d-lg-block sidebar-right" id="sidebar-right">
            <div class="mb-4">
                <h5 class="fw-bold mb-1">Weather Forecast</h5>
                <span class="text-muted small" id="weather-location-text">Baguio City</span>
            </div>

            <div class="weather-card-main">
                <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="temp-big" id="temp-big">--°</div>
                    <div class="fw-medium mt-1" id="condition-text">Loading...</div>
                </div>

                <div id="weather-icon-box" style="width:72px; height:72px; display:flex; align-items:center; justify-content:center;">
                    <img id="weather-icon" src="" alt="" style="max-width:72px; max-height:72px; display:none;">
                    <i class="bi bi-brightness-high-fill" id="weather-icon-fallback" style="font-size: 3.5rem; color: var(--tertiary-color);"></i>
                </div>
                </div>

                <div class="weather-details" id="weather-details" style="margin-top:10px;">
                <span id="wind-text"><i class="bi bi-wind me-1"></i> -- km/h</span>
                <span id="humidity-text" style="margin-left:12px;"><i class="bi bi-droplet-fill me-1"></i> --%</span>
                </div>

                <div id="weather-loading" style="display:none; margin-top:8px;">
                <small class="text-muted">Updating weather…</small>
                </div>
            </div>

            <h6 class="fw-bold mb-3" style="margin-top:18px;">5-Day Forecast</h6>
            <div class="forecast-list" id="forecast-list">
                <div class="forecast-item placeholder">
                <div class="d-flex align-items-center">
                    <i class="bi bi-cloud text-secondary me-3 fs-5"></i>
                    <span class="fw-medium">—</span>
                </div>
                <div><span class="fw-bold">--°</span> <span class="text-muted small">--°</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/botReply.js') }}"></script>
<script src="{{ url_for('static', filename='js/weather.js') }}"></script>
{% endblock content %}
